<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual Lab: Construction of Square Wave from Harmonics</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Segoe+UI&display=swap');

  /* Global and body */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: radial-gradient(ellipse at center, #0a0a0a 0%, #121212 80%);
    color: #eee;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    user-select: none;
  }
  /* Header style */
  header {
    padding: 1rem;
    text-align: center;
    background: #1a1a1a;
    width: 100%;
    box-shadow: 0 4px 12px rgba(97, 218, 251, 0.4);
    border-bottom: 2px solid #61dafb;
  }
  header h1 {
    margin: 0;
    font-weight: 800;
    font-size: 2rem;
    color: #61dafb;
    letter-spacing: 1px;
    text-shadow: 0 0 8px #61dafb;
  }

  /* Main container */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    max-width: 900px;
    width: 95%;
    margin: 1.5rem auto 2rem;
    background: #222;
    border-radius: 14px;
    box-shadow: 0 0 20px 3px #0ff8ff66;
    padding: 1.5rem 2rem;
    border: 1px solid #0ff8ff44;
  }

  /* Slider container */
  .slider-container {
    margin: 1rem 0 2rem;
    display: flex;
    align-items: center;
  }
  .slider-container label {
    flex: 0 0 160px;
    font-size: 1.2rem;
    font-weight: 600;
    color: #a0e9ff;
    text-shadow: 0 0 4px #3fcfffcc;
  }
  /* Slider styling with glow effect */
  .slider-container input[type=range] {
    flex: 1;
    margin-left: 1.2rem;
    -webkit-appearance: none;
    height: 12px;
    border-radius: 6px;
    background: linear-gradient(90deg, #0ff8ff88 0%, #61dafbcc 100%);
    outline: none;
    cursor: pointer;
    box-shadow: 0 0 7px #61dafbcc;
    transition: background 0.3s ease;
  }
  .slider-container input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 26px;
    height: 26px;
    background: #61dafb;
    cursor: pointer;
    border-radius: 50%;
    border: 2px solid #0ff8ff;
    box-shadow: 0 0 14px #0ff8ff, 0 0 8px #61dafb;
    transition: background 0.3s ease, transform 0.2s ease;
  }
  .slider-container input[type=range]:hover::-webkit-slider-thumb,
  .slider-container input[type=range]:focus::-webkit-slider-thumb {
    background: #00f0ff;
    transform: scale(1.2);
    box-shadow: 0 0 20px #00ffffcc, 0 0 15px #00cfff;
  }
  .slider-container input[type=range]::-moz-range-thumb {
    width: 26px;
    height: 26px;
    background: #61dafb;
    border-radius: 50%;
    border: 2px solid #0ff8ff;
    box-shadow: 0 0 14px #0ff8ff, 0 0 8px #61dafb;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
  }
  .slider-container input[type=range]:hover::-moz-range-thumb,
  .slider-container input[type=range]:focus::-moz-range-thumb {
    background: #00f0ff;
    transform: scale(1.2);
    box-shadow: 0 0 20px #00ffffcc, 0 0 15px #00cfff;
  }

  /* Canvas styling */
  canvas {
    background: #000;
    border: 1px solid #0ff8ff55;
    border-radius: 12px;
    box-shadow: 0 0 20px #0ff8ffaa;
    width: 100%;
    height: 320px;
    display: block;
    cursor: crosshair;
    transition: box-shadow 0.3s ease;
  }
  canvas:hover {
    box-shadow: 0 0 30px #00ffffee;
  }

  /* Harmonics info text */
  .harmonics-info {
    margin-top: 0.7rem;
    font-size: 1.1rem;
    color: #aef4ff;
    font-family: 'Roboto Mono', monospace;
    text-align: center;
    text-shadow: 0 0 3px #3fd1ffcc;
    user-select: none;
  }

  /* Footer styling */
  footer {
    font-size: 0.85rem;
    color: #444;
    text-align: center;
    margin-bottom: 1rem;
  }

</style>
</head>
<body>
<header>
  <h1>Virtual Lab: Square Wave Construction from Harmonics</h1>
</header>
<main>
  <div class="slider-container">
    <label for="harmonicsRange">Number of Harmonics: <span id="harmonicsCount">1</span></label>
    <input type="range" id="harmonicsRange" min="1" max="21" step="2" value="1" />
  </div>
  <canvas id="waveCanvas" width="840" height="320" aria-label="Waveform graph"></canvas>
  <div class="harmonics-info" id="harmonicsInfo">
    Fundamental Frequency: 1 Hz (for demonstration)<br />
    Displaying odd harmonics from n = 1 to 1
  </div>
</main>
<footer>
  &copy; 2024 Virtual Lab - Construct square wave by summing sine harmonics
</footer>

<script>
(() => {
  const canvas = document.getElementById('waveCanvas');
  const ctx = canvas.getContext('2d');
  const harmonicsRange = document.getElementById('harmonicsRange');
  const harmonicsCountLabel = document.getElementById('harmonicsCount');
  const harmonicsInfo = document.getElementById('harmonicsInfo');

  const width = canvas.width;
  const height = canvas.height;
  const margin = { left: 50, right: 30, top: 20, bottom: 50 };

  function drawGrid() {
    ctx.clearRect(0, 0, width, height);

    // Background fill
    const gradBg = ctx.createRadialGradient(width/2, height/2, height/4, width/2, height/2, height);
    gradBg.addColorStop(0, '#111a1f');
    gradBg.addColorStop(1, '#000000');
    ctx.fillStyle = gradBg;
    ctx.fillRect(0, 0, width, height);

    // Grid lines style
    ctx.strokeStyle = '#244e57';
    ctx.lineWidth = 1;
    ctx.font = '12px Roboto Mono, monospace';
    ctx.fillStyle = '#448899';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    // Vertical grid lines and labels (Time axis)
    const gridStepX = 60;
    const numLinesX = Math.floor((width - margin.left - margin.right) / gridStepX);
    for (let i = 0; i <= numLinesX; i++) {
      let x = margin.left + i * gridStepX;
      ctx.beginPath();
      ctx.moveTo(x, margin.top);
      ctx.lineTo(x, height - margin.bottom);
      ctx.stroke();
      // Time in ms (period 1 sec)
      let tMs = (i * gridStepX) / (width - margin.left - margin.right) * 1000;
      ctx.fillText(tMs.toFixed(0) + ' ms', x, height - margin.bottom + 18);
    }

    // Horizontal grid lines and labels (Amplitude axis)
    const gridStepY = 40;
    const numLinesY = Math.floor((height - margin.top - margin.bottom) / gridStepY);
    ctx.textAlign = 'right';
    for (let i = -numLinesY; i <= numLinesY; i++) {
      let y = height / 2 - i * gridStepY;
      if (y < margin.top || y > height - margin.bottom) continue;
      ctx.beginPath();
      ctx.moveTo(margin.left, y);
      ctx.lineTo(width - margin.right, y);
      ctx.stroke();
      ctx.fillText(i.toFixed(0), margin.left - 7, y);
    }

    // Draw axes thicker with glowing effect
    ctx.strokeStyle = '#23fff1';
    ctx.lineWidth = 3;
    ctx.shadowColor = '#23fff1';
    ctx.shadowBlur = 14;

    // X-axis
    ctx.beginPath();
    ctx.moveTo(margin.left, height / 2);
    ctx.lineTo(width - margin.right, height / 2);
    ctx.stroke();

    // Y-axis
    ctx.beginPath();
    ctx.moveTo(margin.left, margin.top);
    ctx.lineTo(margin.left, height - margin.bottom);
    ctx.stroke();

    // Reset shadow
    ctx.shadowBlur = 0;

    // Axis labels with glow
    ctx.fillStyle = '#2afff9';
    ctx.textAlign = 'center';
    ctx.shadowColor = '#2afff9';
    ctx.shadowBlur = 6;
    ctx.fillText('Time â†’', width/2, height - 15);

    ctx.save();
    ctx.translate(18, height/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillText('Amplitude', 0, 0);
    ctx.restore();

    ctx.shadowBlur = 0;
  }

  const f0 = 1; // 1 Hz fundamental frequency

  function harmonicColor(n) {
    const baseHue = 180; // cyan hues
    return `hsla(${(baseHue + n*32) % 360}, 90%, 60%, 0.15)`;
  }
  // Draw harmonic component waves (just one fundamental for subtlety)
  function drawFundamental(samples, amplitudeScale, yCenter) {
    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(97, 218, 251, 0.25)';
    ctx.beginPath();
    for (let i = 0; i <= samples; i++) {
      let t = i / samples;
      let x = margin.left + i;
      let y = Math.sin(2 * Math.PI * f0 * t);
      let py = yCenter - y * amplitudeScale;
      if (i === 0) ctx.moveTo(x, py);
      else ctx.lineTo(x, py);
    }
    ctx.stroke();
  }

  // Draw gradient sum wave with smooth animation
  let lastWaveformPoints = [];
  let animationId = null;

  function drawWave(harmonicsCount) {
    drawGrid();

    harmonicsCountLabel.textContent = harmonicsCount;
    harmonicsInfo.innerHTML = `
      Fundamental Frequency: 1 Hz (fixed for demonstration)<br />
      Displaying odd harmonics from n = 1 to ${harmonicsCount}
    `;

    const samples = width - margin.left - margin.right;
    const yCenter = height / 2;
    const amplitudeScale = (height - margin.top - margin.bottom) / 4;

    // Calculate target waveform points
    let targetPoints = [];
    for (let i = 0; i <= samples; i++) {
      let t = i / samples;
      let y = 0;
      for (let n = 1; n <= harmonicsCount; n += 2) {
        y += (1 / n) * Math.sin(2 * Math.PI * f0 * n * t);
      }
      y *= 4 / Math.PI;
      targetPoints.push(y);
    }

    // Animation: interpolate between last points and new target points
    let progress = 0;
    const duration = 400; // in ms
    const startPoints = lastWaveformPoints.length === samples + 1 ? lastWaveformPoints : targetPoints.slice();

    if (animationId) cancelAnimationFrame(animationId);

    function animate() {
      progress += 1/60;
      if (progress > 1) progress = 1;

      ctx.clearRect(0, 0, width, height);
      drawGrid();
      drawFundamental(samples, amplitudeScale, yCenter);

      ctx.lineWidth = 4;
      ctx.shadowColor = '#0ffefb';
      ctx.shadowBlur = 18;

      // Gradient stroke for the sum waveform
      let grad = ctx.createLinearGradient(margin.left, 0, width - margin.right, 0);
      grad.addColorStop(0, '#00ffd5');
      grad.addColorStop(0.5, '#00bfff');
      grad.addColorStop(1, '#00f0ff');

      ctx.strokeStyle = grad;
      ctx.beginPath();
      for (let i = 0; i <= samples; i++) {
        let x = margin.left + i;
        let interpY = startPoints[i] + (targetPoints[i] - startPoints[i]) * progress;
        let py = yCenter - interpY * amplitudeScale;
        if (i === 0) ctx.moveTo(x, py);
        else ctx.lineTo(x, py);
      }
      ctx.stroke();

      ctx.shadowBlur = 0;

      // Legend box
      const legendX = width - margin.right - 200;
      const legendY = margin.top + 20;
      ctx.fillStyle = '#16d9e3';
      ctx.font = 'bold 15px Roboto Mono, monospace';
      ctx.textAlign = 'left';
      ctx.shadowColor = '#16d9e3';
      ctx.shadowBlur = 12;
      ctx.fillText('Blue Glow: Sum of Odd Harmonics', legendX, legendY);
      ctx.fillText('Light Cyan: Fundamental (n=1)', legendX, legendY + 26);

      ctx.shadowBlur = 0;

      // Legend lines
      ctx.lineWidth = 4;
      ctx.strokeStyle = '#00ffff';
      ctx.beginPath();
      ctx.moveTo(legendX - 80, legendY - 6);
      ctx.lineTo(legendX - 50, legendY - 6);
      ctx.stroke();

      ctx.lineWidth = 3;
      ctx.strokeStyle = 'rgba(97, 218, 251, 0.25)';
      ctx.beginPath();
      ctx.moveTo(legendX - 80, legendY + 20);
      ctx.lineTo(legendX - 50, legendY + 20);
      ctx.stroke();

      if (progress < 1) {
        animationId = requestAnimationFrame(animate);
      } else {
        lastWaveformPoints = targetPoints.slice();
      }
    }
    animate();
  }

  function update() {
    let harmonicsCount = parseInt(harmonicsRange.value);
    if (harmonicsCount % 2 === 0) harmonicsCount -= 1;
    harmonicsRange.value = harmonicsCount;
    drawWave(harmonicsCount);
  }

  harmonicsRange.addEventListener('input', update);

  update();
})();
</script>

</body>
</html>

